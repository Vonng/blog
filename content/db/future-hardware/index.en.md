---
title: Modern Hardware for Future Databases
linkTitle: "Modern Hardware for Future Databases"
date: 2024-11-20
author: |
  [Feng Ruohang](https://vonng.com) ([@Vonng](https://vonng.com/en/)) | [WeChat Original](https://mp.weixin.qq.com/s/0Y17J-opjq1fceRi8777Xg) | [English Original](https://transactional.blog/blog/2024-modern-database-hardware)
summary: >
  This article is a comprehensive review of how hardware developments affect database design, introducing key hardware advances in networking, storage, and computing.
tags: [Database]
---


> Author: Alex Miller 2024-11-19 @ Snowflake, Apple, Google
>
> Translator: Feng Ruohang & GPT o1, PG Grand Master, Database Veteran, Cloud Computing Maverick

Translator's Recommendation: This article is a comprehensive review of how hardware developments affect database design, introducing key hardware advances in networking, storage, and computing. I've always believed that fully utilizing new hardware (rather than tinkering with so-called distributed systems) is the right path for database kernel development.
See "[Reclaiming the Dividends of Computer Hardware](https://mp.weixin.qq.com/s/1OSRcBfd58s0tgZTUZHB9g)" and "[Are Distributed Databases a False Requirement](https://mp.weixin.qq.com/s/-eaCoZR9Z5srQ-1YZm1QJA)".
This article excellently introduces some cutting-edge software-hardware integration practices in the database field, worth reading.




--------


[Original: Modern Hardware for Future Databases](https://transactional.blog/blog/2024-modern-database-hardware)

We're in an exciting era for databases, with continuous progress in every major resource domain, and each advance has the potential to influence optimal database architectures. Overall, I hope to see some interesting shifts in database architectures over the next decade, but I'm uncertain whether we'll have the necessary hardware support.


--------

## Networking

According to [Stonebraker's presentation at HPTS 2024](https://muratbuffalo.blogspot.com/2024/09/hpts24-day-1-part-1.html), some benchmarks using VoltDB found that approximately 60% of server-side CPU time was spent on the TCP/IP protocol stack. VoltDB itself is a database architecture designed to eliminate as much non-query processing work as possible to serve requests, so this is an extreme example. However, this still effectively points out that TCP's computational overhead is not trivial, and this problem becomes more apparent as network bandwidth increases. While this isn't a new observation, a series of incremental upgrade solutions have been proposed.

One proposed solution is replacing TCP with another UDP-based protocol, with QUIC being a commonly chosen example. However, this idea is misguided. ["While this is a seriously inaccurate simplification, at the simplest level, QUIC is just TCP encapsulated and encrypted in a UDP payload."](https://blog.apnic.net/2022/11/03/comparing-tcp-and-quic/) The CPU overhead of TCP and QUIC is [also very similar](https://www.fastly.com/blog/measuring-quic-vs-tcp-computational-efficiency). To achieve significant improvements, one needs to deviate further from TCP and specialize for specific environments, such as papers like [Homa](https://networking.harshkapadia.me/files/homa/research-papers/its-time-to-replace-tcp-in-the-datacenter-v2.pdf) showing some improvements in datacenter environments. But even with better protocols, the greater optimization potential still lies in reducing kernel network stack overhead.

> **Note**: If you're wondering while reading why QUIC is mentioned here, it's because I've participated multiple times in discussions where TCP or TLS was blamed for certain problems, and migrating to QUIC was suggested as a solution. QUIC can indeed help solve some problems, but there are also some problems it can't improve, or might even make worse. It's important to understand that steady-state latency and bandwidth belong to the latter category.

One way to reduce kernel workload is moving computationally intensive but simple parts to hardware. This has been gradually implemented over time, such as enhanced [offloading of segmentation and checksum tasks to network cards](https://docs.kernel.org/networking/segmentation-offloads.html). A more recent improvement is [KTLS](https://www.kernel.org/doc/html/v5.2/networking/tls-offload.html), which allows offloading packet encryption in TLS to network cards as well. Attempts to offload entire TCP to hardware, in the form of [TCP Offload Engines (TOE)](https://wiki.linuxfoundation.org/networking/toe), have been systematically rejected by Linux maintainers. Therefore, despite these nice improvements, the main parts of the TCP protocol stack remain the kernel's responsibility.

Hence, another solution is removing the kernel as an intermediary layer between network cards and applications. Frameworks like [Data Plane Development Kit (DPDK)](https://www.dpdk.org/) allow user space to poll network cards for packets, eliminating interrupt overhead, and keeping all processing in user space means no need to enter and exit the kernel. DPDK has also faced difficulties in adoption because it requires exclusive control of network cards. Therefore, each host needs two network cards, one for DPDK and another for the operating system and all other processes. Marc Richards created a nice [Linux kernel vs DPDK benchmark](https://talawah.io/blog/linux-kernel-vs-dpdk-http-performance-showdown/), showing DPDK provides 50% throughput improvement, then lists a series of drawbacks that must be accepted to gain this 50% improvement. This seems to be a tradeoff most databases aren't interested in - even ScyllaDB has largely abandoned investment in this.

Newer hardware provides an interesting new option: removing CPUs from the network path. [RDMA (Remote Direct Memory Access)](https://www.naddod.com/blog/easily-understand-rdma-technology) provides *verbs*, a limited set of operations (mainly read, write, and 8-byte CAS) that can be executed entirely within network cards without CPU interaction. Cutting out CPUs, remote read latency approaches 1 microsecond, while TCP latency exceeds 100 microseconds. As part of RDMA, responsibility for packet loss and flow control is also completely delegated to network cards. Cutting out CPUs also means large amounts of data can be transmitted without making CPUs bottlenecks.

> **Note**: Why is delegating packet loss detection and flow control to hardware acceptable for RDMA, but Linux maintainers have consistently refused to do this for TCP? Because this is a different and much more restricted API, reducing complexity between network cards and hosts. ["TCP Offload is a Dumb Idea Whose Time Has Come"](https://scholar.google.com/scholar?cluster=4106138525527042387) is interesting reading in this area. (From 2003!)

Using RDMA as low-latency and high-throughput network primitives changes how people design databases. ["The End of a Myth: Distributed Transactions Can Scale"](https://www.vldb.org/pvldb/vol10/p685-zamanian.pdf/) shows RDMA's low latency enables classic 2PL+2PC to scale to large clusters. ["Is Scalable OLTP in the Cloud a Solved Problem?"](https://www.cidrdb.org/cidr2023/papers/p50-ziegler.pdf) proposes sharing writable page caches between nodes, because low latency makes tighter coupling of components feasible. RDMA isn't just for OLTP databases; BigQuery uses [RDMA Shuffle-based joins](https://cloud/.google.com/blog/products/bigquery/in-memory-query-execution-in-google-bigquery) because of its high throughput. Changing latency and CPU utilization at given throughput changes optimal design choices, or unlocks new designs previously considered infeasible[^3].

> **Note**: To use RDMA, I strongly recommend using [libfabric](https://ofiwg.github.io/libfabric/), as it abstracts over all different RDMA vendors and libraries. [RDMAmojo blog](https://rdmamojo.com/) has years of specialized content about RDMA and is one of the best resources for learning all aspects of RDMA.

Finally, there's a newer class of hardware continuing the trend of putting more computational power into network cards themselves: SmartNICs or Data Processing Units (DPUs). They allow arbitrary computation to be delegated to network cards and potentially invoked in response to requests from other network cards. These technologies are quite novel. I suggest checking out ["DPDPU: Data Processing with DPUs"](https://scholar.google.com/scholar?cluster=14622696590036176289) for an overview, ["DDS: DPU-optimized Disaggregated Storage"](https://scholar.google.com/scholar?cluster=12305794631120951674) for how to integrate them into databases, and ["Azure Accelerated Networking: SmartNICs in the Public Cloud"](https://www.microsoft.com/en-us/research/uploads/prod/2018/03/Azure_SmartNIC_NSDI_2018.pdf) for deployment details. Overall, I expect SmartNICs to extend RDMA from simple reads and writes to allow general-purpose RPC bypassing CPUs (for computationally inexpensive request-reply).


--------

## Storage

In storage devices, there are some advances aimed at reducing total cost of ownership for storage devices in specific use cases. Manufacturers cleverly discovered they could read narrower strips than the track width that magnetizes hard disk platters from writes, so tracks could be overlapped to minimum width. Thus, we have [Shingled Magnetic Recording (SMR)](https://www.storagereview.com/news/what-is-shingled-magnetic-recording-smr) hard drives, introducing the concept of dividing storage into **zones** that only support append or erase. SMR HDDs target use cases like [object storage](https://dropbox.tech/infrastructure/four-years-of-smr-storage-what-we-love-and-whats-next) where access is infrequent but large amounts of data need storage.

Similar ideas have been applied to SSDs, and **Zoned SSDs** have also emerged. Exposing zones in SSDs means drives don't need to provide Flash Translation Layers (FTL) or complex garbage collection processes. Like SMR, this reduces ZNS SSD costs relative to "regular" SSDs, but also specifically focuses on application-driven garbage collection being more efficient, thus reducing total write amplification and extending drive lifespan. Consider LSMs (Log-Structured Merge Trees) on SSDs - they already operate through incremental appends and large erase blocks. Removing FTL between LSMs and SSDs opens optimization opportunities. Recently, Google and Meta collaborated on [Flexible Data Placement (FDP)](https://www.micron.com/about/blog/storage/innovations/eliminating-the-io-blender-promise-of-flexible-data-placement) proposals, which are more like hints for grouping writes with related lifecycles rather than strictly enforcing zones like ZNS. The goal is achieving easier upgrade paths, allowing SSDs to ignore FDP parts of write requests while still being semantically correct, just with worse performance or write amplification.

> **Note**: If you were expecting discussion about [persistent memory](https://pmem.io/pmdk/libpmem/), unfortunately Intel has discontinued [Optane](https://en.wikipedia.org/wiki/3D_XPoint), so this is currently a dead end. There seem to be some companies like [Kioxia](https://americas.kioxia.com/en-ca/business/news/2021/memory-20210913-1.html) or [Everspin](https://investor.everspin.com/news-releases/news-release-details/everspin-technologies-unveils-persyst-simplifying-persistent) continuing efforts in this area, but I haven't heard of actual applications.

Other improvements aren't aimed at cost efficiency but at improving the feature set supported by storage devices. Particularly focusing on NVMe, NVMe added [copy commands](https://www.snia.org/educational-library/towards-copy-offload-linux-nvme-2021) to eliminate the waste of reading and writing the same data. [Fused compare-and-write commands](https://files.futurememorystorage.com/proceedings/2013/20130812_PreConfD_Marks.pdf#page=46) allow CAS operations to be delegated to drives themselves, enabling innovative designs like delegating [optimistic lock coupling](https://scholar.google.com/scholar?cluster=7804091931900436017) to drives. NVMe inherited support for [Data Integrity Field (DIF)](https://lwn.net/Articles/548294/) and [Data Integrity Extension (DIX)](https://oss.oracle.com/~mkp/docs/dix.pdf) from SCSI, enabling page checksums to be delegated to drives (Oracle notably uses this). There are also projects like [KV-SSD](https://blocksandfiles.com/2019/09/05/samsungs-potentially-groundbreaking-keyvalue-ssd/) that change the entire data model from storing blocks by index to storing objects by key, even going toward completely replacing software storage engines. SSD manufacturers continue to make SSDs capable of more operations.

> **Note**: As of July 25, 2024, AWS has [discontinued publishing S3 Select](https://aws.amazon.com/blogs/storage/how-to-optimize-querying-your-data-in-amazon-s3/), possibly to support [S3 Object Lambda](https://aws.amazon.com/s3/features/object-lambda/).

As the penultimate step in SSD functionality, **SmartSSDs** are emerging, allowing arbitrary computation to be integrated into SSDs. ["Query Processing on SmartSSDs: Opportunities and Challenges"](http://pages.cs.wisc.edu/~yxy/cs764-f20/papers/SmartSSD.pdf) reviews their applications in query processing tasks. Pushing filters down to storage is always beneficial; I often cite earlier work like [PushdownDB](https://marcoserafini.github.io/assets/pdf/pushdown.pdf) leveraging S3 Select as excellent examples in the analytics domain. Using SmartSSDs, we have papers like ["POLARDB Meets Computational Storage"](https://www.usenix.org/conference/fast20/presentation/cao-wei). Even without specialized integration, some argue that even transparent drive-internal compression can narrow the gap between B+ trees and LSMs in write amplification ([reference](https://www.usenix.org/conference/fast22/presentation/qiao)). Leveraging SmartSSDs remains an emerging research area, but its potential impact is enormous.


--------

## Computing

### Transaction Processing

At the recent VLDB conference, two authorities in database research published a position paper: ["Cloud-Native Database Systems and Unikernels: Reimagining OS Abstractions for Modern Hardware"](https://www.vldb.org/pvldb/vol17/p2115-leis.pdf), arguing that Unikernels allow databases to customize operating systems for their exact needs. Earlier work on [VMCache](https://scholar.google.com/scholar?cluster=7903866005464261403) particularly emphasized the challenges of efficient database buffer management, where one must either accept the complexity of [pointer swizzling](https://db.in.tum.de/~leis/papers/leanstore.pdf) or frequently hook into the kernel calling `mmap()` related system calls.

Neither choice is ideal, while Unikernels provide direct access to virtual memory primitives. As this area receives more attention, the effort required to develop Unikernels is decreasing. [Akira Kurogane](https://jp.linkedin.com/in/akira-kurogane) got [MongoDB running as a Unikernel](https://www.linkedin.com/pulse/mongodb-booted-unikernel-os-akira-kurogane-vdf7c/) through [Unikraft](https://unikraft.org/) with minimal cost, with subsequent posts showing performance improvements without any MongoDB internal changes. There's always been an endless joke that databases want to become operating systems, because the desire for performance improvements requires more control over networking, file systems, disk I/O, memory, etc., and Unikernel databases provide exactly that, making it possible.

To achieve data confidentiality beyond TLS or disk encryption, secure enclaves allow execution of verifiably untampered code, making operated data immune from compromised operating systems. [Trusted Platform Modules (TPM)](https://learn.microsoft.com/en-us/windows/security/hardware-security/tpm/tpm-fundamentals) allow keys to be securely stored in machines, while secure enclaves extend to arbitrary code and data. This makes it possible to build databases with extremely high resilience to malicious attacks, but with several design constraints. Microsoft has published research on [integrating secure enclaves into Hekaton](https://blog.acolyer.org/2018/07/05/enclavedb-a-secure-database-using-sgx/) and has released this work as part of [SQL Server Always Encrypted](https://learn.microsoft.com/en-us/sql/relational-databases/security/encryption/always-encrypted-enclaves?view=sql-server-ver16). Alibaba has also published their efforts in building [enclave-native storage engines](https://vldb.org/pvldb/vol14/p1019-sun.pdf) for enterprise customers concerned about data confidentiality. Databases have always promoted security improvements through [regulatory compliance](https://www.fortanix.com/faq/confidential-computing/how-does-confidential-computing-help-with-regulatory-compliance-requirements), and secure enclaves are a meaningful advance in data confidentiality.

Since Spanner introduced [TrueTime](https://sookocheff.com/post/time/truetime/), clock synchronization has become highly focused in transaction ordering for geographically distributed databases. Every major cloud provider has an NTP service connected to atomic clocks or GPS satellites ([AWS](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/set-time.html), [Azure](https://learn.microsoft.com/en-us/azure/virtual-machines/linux/time-sync#overview), [GCP](https://developers.google.com/time/faq#whatis)). This is very useful for any similar designs, such as CockroachDB or Yugabyte, whose correctness critically depends on clock synchronization, while conservative wide error ranges degrade performance. AWS's recent Aurora Limitless also [uses a TrueTime-like design](https://www.youtube.com/watch?v=a9FfjuVJ9d8&t=29m25s). This is the only cloud-specific, not entirely hardware content mentioned, because this is major cloud suppliers providing users with expensive hardware (atomic clocks) that users wouldn't otherwise consider purchasing themselves.

Hardware transactional memory has quite an unfortunate history. [Sun's Rock processor](https://www.theregister.com/2007/08/21/sun_transactional_memory_rock/) had hardware transactional memory capabilities until Sun was acquired and the Rock project was terminated. Intel attempted to release it twice but had to disable it both times. There's some interesting work on applying hardware transactional memory to in-memory databases, but besides finding some old CPUs for experiments, we all have to wait for CPU manufacturers to announce they plan to try again.

> **Note**: The first time was due to [a bug](http://techreport.com/news/26911/errata-prompts-intel-to-disable-tsx-in-haswell-early-broadwell-cpus), the second time due to [a side-channel attack breaking KASLR](https://www.blackhat.com/docs/us-16/materials/us-16-Jang-Breaking-Kernel-Address-Space-Layout-Randomization-KASLR-With-Intel-TSX-wp.pdf). There's also a speculative execution timing attack discovered by [misunderstanding CTF challenge intent](https://blog.ret2.io/2019/06/26/attacking-intel-tsx/).

### Query Processing

There have always been companies founded trying to leverage specialized hardware to accelerate query processing, achieving better performance and cost efficiency than competitors using only CPUs. GPU-driven databases like [Voltron](https://voltrondata.com/theseus.html), [HEAVY.ai](https://www.heavy.ai/), and [Brytlyt](https://brytlyt.io/) are first steps in this direction. I wouldn't be surprised if Intel or AMD's integrated graphics gain OpenCL support at some point in the future, opening doors for all databases to assume some degree of GPU capability in broader hardware configurations.

> **Note**: OpenGL compute shaders are the most general and portable form of using GPUs for arbitrary computation, and integrated graphics chipsets already support these. However, I can't find any database-related papers using them.

There are also opportunities to use more energy-efficient hardware. Latest Neural Processing Units (NPUs) and Tensor Processing Units (TPUs) have been proven usable for query processing in work like ["TCUDB: Accelerating Database with Tensor Processors"](https://dl.acm.org/doi/pdf/10.1145/3514221.3517869). Some companies have tried leveraging FPGAs. [Swarm64](https://dbdb.io/db/swarm64) attempted (but possibly failed) to enter this market. AWS itself also attempted with [Redshift AQUA](https://aws.amazon.com/blogs/aws/new-aqua-advanced-query-accelerator-for-amazon-redshift/). Even the largest companies seem to find going to ASICs not worthwhile, as even Oracle [stopped their SPARC development](https://www.hpcwire.com/2017/09/07/oracle-layoffs-reportedly-hit-sparc-solaris-hard/) in 2017. I'm not very optimistic about FPGA to ASIC prospects, because memory bandwidth will become the main bottleneck anyway at some point, but [ADMS](https://adms-conf.org/) is the conference to watch for papers in this area.

> **Note**: Strictly speaking, ADMS is a workshop affiliated with VLDB, but I don't know the word for collectively referring to conferences, journals, and workshops.


--------

## Cloud Availability

Finally, let's face this frustrating fact: if unavailable, none of these hardware advances matter. For today's systems, this means cloud, and cloud hasn't provided customers with cutting-edge hardware advances.

In networking, the situation isn't ideal. DPDK is the most accessible advanced networking technology because most clouds allow certain types of instances to have multiple network cards. AWS provides pseudo-RDMA in the form of [Scalable Reliable Datagram (SRD)](https://scholar.google.com/scholar?cluster=7115577907027624509), which according to [benchmarks](https://scholar.google.com/scholar?cluster=9445549416525532418), performs roughly between TCP and RDMA. True RDMA is only available in high-performance computing instances on Azure, GCP, and OCI. Only Alibaba provides [RDMA](https://www.alibabacloud.com/help/en/ecs/user-guide/erdma-overview) on general computing instances.

> **Note**: Though there might be similar poor latency impacts as SRD. Alibaba deployed RDMA through iWARP, which might be slightly slower, but I haven't seen any benchmarks.

SmartNICs aren't publicly available anywhere. There are good reasons for this: Microsoft's published papers point out that [deploying RDMA is difficult](https://scholar.google.com/scholar?cluster=12305794631120951674). In fact, [very difficult](https://scholar.google.com/scholar?cluster=2434531805096404846). Even their paper on [successfully using RDMA](https://scholar.google.com/scholar?cluster=6986943445603020796) emphasizes how very difficult it is. It's been nearly a decade since Microsoft started using RDMA internally, but it's still not available in their cloud. I can't guess whether or when it might appear.

In storage, the situation isn't much better. SMR HDDs, when they briefly entered consumer markets, still appeared as drives supporting block storage APIs, and consumers [reacted very negatively](https://arstechnica.com/gadgets/2020/04/caveat-emptor-smr-disks-are-being-submarined-into-unexpected-channels/). ZNS SSDs seem similarly locked behind enterprise-only procurement agreements. One might think Intel stopping Optane brand persistent memory and SSDs means they're unavailable in clouds, but Alibaba still provides [persistent memory optimized instances](https://www.alibabacloud.com/help/en/tair/product-overview/persistent-memory-optimized-instances). The excellent team at [Spare Cores](https://sparecores.com/) actually provided me with `nvme id-ctrl` output from every cloud supplier, and none of the NVMe devices they acquired support any optional features: copy, fused compare-and-write, data integrity extensions, or multi-block atomic writes.

> **Note**: Though AWS supports [torn write prevention](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/storage-twp.html), and GCP previously had similar documentation.

Alibaba is also the only cloud supplier investing in SmartSSDs, collaborating with ScaleFlux on research for PolarDB. This still means SmartSSDs aren't publicly available, but even the paper acknowledges this is "the first actual deployment of a cloud-native database using computational storage drives reported in public literature."

In computing, the situation finally improves. Clouds fully allow Unikernels, TPMs are widely available, but as far as I know, only [AWS](https://aws.amazon.com/ec2/nitro/nitro-enclaves/) and [Azure](https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-computing-enclaves) support secure enclaves. Time synchronization is available but without promised error bounds making it impossible to critically depend on. (Hardware transactional memory isn't available, but it's hard to blame cloud suppliers for this.) AI's explosive growth means sufficient funding to support more efficient computing resources. GPUs are available in all clouds. AWS[^5], Azure, IBM, and Alibaba provide FPGA instances. (GCP and OCI don't.) The unfortunate reality is that faster computing only matters when computing becomes the bottleneck. Both GPUs and FPGAs suffer from memory limitations, so can't maintain databases in their local memory. Instead, they need to rely on data streaming in and out, meaning they're limited by PCIe speeds. All this encourages thoughtful motherboard layouts and bus designs in local devices, but this isn't feasible in clouds.

> **Note**: Ideally, one would want peer DMA support, able to read data directly from disk to FPGA, but at least AWS's F1 doesn't support this.

Therefore, my view on next-generation databases is pessimistic: no one can build databases that critically depend on these new hardware advances before they become available, but no cloud supplier wants to deploy hardware that can't be immediately used. Next-generation databases are trapped by this circular dependency because they don't yet exist.

> **Note**: Except cloud suppliers themselves. Most notably, Microsoft and Google already have RDMA internally and extensively use it in their database products while not allowing public use. I've had a draft article outline titled "Cloud Suppliers' RDMA Competitive Advantage."

However, Alibaba's performance is surprisingly excellent. They consistently lead in making all hardware advances available. I'm surprised not to see frequent use of Alibaba for benchmarking in academia and industry.